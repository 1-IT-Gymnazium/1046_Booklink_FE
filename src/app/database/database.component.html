<div class="max-w-6xl mx-auto">
    <div class="p-6">
        <!--Breadcrumb structure-->
        <h1 *ngIf="currentView != 'book'" class="flex space-x-2 text-2xl font-bold text-gray-800 mb-4">
            <span *ngFor="let crumb of breadcrumb; let i = index">
                <span class="cursor-pointer hover:underline" (click)="navigateBack(i)">
                    {{ crumb }}
                </span>
                <span *ngIf="i < breadcrumb.length - 1"> > </span>
            </span>
        </h1>

        <!--Add "Current view entity"-->
        <button *ngIf="currentView != 'book'" (click)="openCreateModal()"
            class="fixed bottom-6 right-6 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition shadow-lg">
            + Add {{ getEntityName() }}
        </button>
    </div>

    <!--Households view-->
    <div *ngIf="currentView === 'households'"
        class="w-full flex justify-center grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div *ngFor="let household of households"
            class="relative bg-white shadow-lg rounded-lg p-6 flex flex-col place-items-center items-center transition-transform duration-300 hover:scale-105 group">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ household.name }}</h3>
            <button (click)="goToRooms(household.id, household.name)"
                class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">
                View Rooms
            </button>

            <button (click)="openEditModal(household)"
                class="absolute top-3 left-5 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536M9 11l6-6 3 3-6 6H9v-3z" />
                </svg>
            </button>


            <button (click)="confirmDelete(household.id)"
                class="absolute top-3 right-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!--Rooms view-->
    <div *ngIf="currentView === 'rooms'"
        class="w-full flex justify-center grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div *ngFor="let room of rooms"
            class="relative bg-white shadow-lg rounded-lg p-6 flex flex-col place-items-center items-center transition-transform duration-300 hover:scale-105 group">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ room.name }}</h3>
            <button (click)="goToBookshelves(room.id, room.name)"
                class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition">
                View Bookshelves
            </button>

            <button (click)="openEditModal(room)"
                class="absolute top-3 left-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536M9 11l6-6 3 3-6 6H9v-3z" />
                </svg>
            </button>


            <button (click)="confirmDelete(room.id)"
                class="absolute top-3 right-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!--Bookshelves view-->
    <div *ngIf="currentView === 'bookshelves'"
        class="w-full flex justify-center grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div *ngFor="let shelf of bookshelves"
            class="relative bg-white shadow-lg rounded-lg p-6 flex flex-col place-items-center items-center transition-transform duration-300 hover:scale-105 group">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ shelf.name }}</h3>
            <button (click)="goToBooks(shelf.id, shelf.name)"
                class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600 transition">
                View Books
            </button>

            <button (click)="openEditModal(shelf)"
                class="absolute top-3 left-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536M9 11l6-6 3 3-6 6H9v-3z" />
                </svg>
            </button>


            <button (click)="confirmDelete(shelf.id)"
                class="absolute top-3 right-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!--Books view-->
    <div *ngIf="currentView === 'books'"
        class="w-full flex justify-center grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <div *ngFor="let book of books"
            class="relative bg-white shadow-lg rounded-lg p-6 flex flex-col place-items-center items-center transition-transform duration-300 hover:scale-105 group">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ book.title }}</h3>
            <h5 class="text-lg font-semibold text-gray-600 mb-2">{{ book.author }}</h5>
            <p class="text-gray-600">{{ book.genre }}</p>
            <button (click)="showBookDetails(book)"
                class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600 transition">
                Show Details
            </button>

            <button (click)="openEditModal(book)"
                class="absolute top-3 left-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536M9 11l6-6 3 3-6 6H9v-3z" />
                </svg>
            </button>


            <button (click)="confirmDelete(book.id)"
                class="absolute top-3 right-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <div *ngIf="currentView === 'book' && bookDetails"
        class="h-[calc(100vh-120px)] flex items-center justify-center overflow-hidden relative bg-gray-50 px-8">

        <!-- Return Buttons -->
        <button *ngIf="!openedFromDashboard" (click)="closeBookDetails()"
            class="absolute top-1 left-8 text-gray-500 hover:text-gray-700 text-2xl">
            &larr; Return to Bookshelf
        </button>

        <button *ngIf="openedFromDashboard" routerLink="/dashboard"
            class="absolute top-1 left-8 text-gray-500 hover:text-gray-700 text-2xl">
            &larr; Return to Dashboard
        </button>

        <div
            class="flex flex-col md:flex-row items-start justify-center gap-12 bg-white p-8 rounded-lg shadow-xl w-full max-w-6xl">
            <!-- Left: Book Info -->
            <div class="w-full md:w-1/2 space-y-4">
                <div class="w-48 h-72 bg-gray-300 flex items-center justify-center text-gray-500 text-lg">
                    Cover
                </div>

                <div>
                    <h1 class="text-3xl font-bold text-gray-800">{{ bookDetails.title }}</h1>
                    <h2 class="text-xl text-gray-700 mt-2">{{ bookDetails.author }}</h2>
                    <p class="text-lg text-gray-600 mt-4"><strong>Genre:</strong> {{ bookDetails.genre }}</p>
                    <p class="text-lg text-gray-600"><strong>ISBN:</strong> {{ bookDetails.isbn }}</p>
                    <p class="text-lg text-gray-600"><strong>Published:</strong> {{ bookDetails.publicationYear }}</p>

                    <!-- Reading List -->
                    <p class="text-lg flex items-center mt-2">
                        <strong>Reading List:</strong>
                        <span class="ml-2 mr-2"
                            [ngClass]="bookDetails.isInReadingList ? 'text-green-600' : 'text-gray-400'">
                            {{ bookDetails.isInReadingList ? '✓ Yes' : '✗ No' }}
                        </span>
                        <input type="checkbox" class="w-6 h-6 border-2 border-gray-500 rounded-md appearance-none cursor-pointer
                       checked:bg-green-600 checked:border-green-600 
                       hover:bg-green-500 hover:border-green-600 
                       checked:hover:bg-gray-400 checked:hover:border-gray-500 focus:ring-2 focus:ring-gray-400"
                            [(ngModel)]="bookDetails.isInReadingList" (change)="toggleReadingList(bookDetails)">
                    </p>
                </div>
            </div>

            <!-- Right: Bookshelf Visual -->
            <div *ngIf="selectedBookshelf" class="w-full md:w-1/2 flex flex-col items-center">
                <h4 class="text-lg font-medium text-gray-700 mb-4">Book's Position on the Bookshelf</h4>

                <div class="grid gap-1 bg-gray-200 p-4 border border-green-600 rounded"
                    [style.gridTemplateColumns]="'repeat(' + selectedBookshelf.numberOfColumns + ', 40px)'"
                    [style.gridTemplateRows]="'repeat(' + selectedBookshelf.numberOfRows + ', 40px)'">
                    <div *ngFor="let cell of bookshelfGrid; let i = index" [ngClass]="{
                 'bg-yellow-300 border-2 border-yellow-600 pulse-animation': isCurrentBookPosition(i),
                 'bg-white': !isCurrentBookPosition(i)
               }" class="w-10 h-10 text-xs flex items-center justify-center border border-gray-300">
                        {{ getCellPosition(i) }}
                    </div>
                </div>

                <p class="mt-4 text-gray-700">
                    {{ bookDetails.title }} is located in this location:<br>Household: {{ currentHouseholdName }},<br>
                    Room: {{ currentRoomName }},<br> Bookshelf: {{ currentBookshelfName }},<br> {{
                    bookDetails.rowsFromTop}}. row from top and {{ bookDetails.columnsFromLeft }}. column from left
                </p>
            </div>

        </div>
    </div>



    <!-- Create Modal -->
    <div *ngIf="isCreateModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg w-[90vw] max-w-5xl">
          <h3 class="text-lg font-semibold mb-4">Create {{ getEntityName() }}</h3>
      
          <!-- Flex container -->
          <div class="flex flex-col md:flex-row gap-8">
      
            <!-- LEFT: Formulář -->
            <div class="flex-1">
              <!-- For households, rooms, bookshelves -->
              <div *ngIf="currentView === 'households' || currentView === 'rooms' || currentView === 'bookshelves'">
                <label class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" [(ngModel)]="newEntity.name"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              </div>
      
              <!-- For bookshelf creation -->
              <div *ngIf="currentView === 'bookshelves'">
                <label class="block text-sm font-medium text-gray-700 mt-3">Description</label>
                <input type="text" [(ngModel)]="newEntity.description"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Number of columns</label>
                <input type="number" [(ngModel)]="newEntity.numberOfColumns"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Number of rows</label>
                <input type="number" [(ngModel)]="newEntity.numberOfRows"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              </div>
      
              <!-- For books -->
              <div *ngIf="currentView === 'books'">
                <label class="block text-sm font-medium text-gray-700">Household</label>
                <select [(ngModel)]="newEntity.householdId" (change)="onHouseholdChange()"
                        class="mt-1 w-full p-2 border rounded">
                  <option *ngFor="let h of householdOptions" [value]="h.id">{{ h.name }}</option>
                </select>
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Room</label>
                <select [(ngModel)]="newEntity.roomId" (change)="onRoomChange()"
                        class="mt-1 w-full p-2 border rounded">
                  <option *ngFor="let r of roomOptions" [value]="r.id">{{ r.name }}</option>
                </select>
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Bookshelf</label>
                <select [(ngModel)]="newEntity.bookshelfId" (change)="onBookshelfChange()"
                        class="mt-1 w-full p-2 border rounded">
                  <option *ngFor="let s of bookshelfOptions" [value]="s.id">{{ s.name }}</option>
                </select>
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Title</label>
                <input type="text" [(ngModel)]="newEntity.title"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Author</label>
                <input type="text" [(ngModel)]="newEntity.author"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
      
                <label class="block text-sm font-medium text-gray-700 mt-3">Genre</label>
                <input type="text" [(ngModel)]="newEntity.genre"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
      
                <div class="flex space-x-4 mt-3">
                  <div class="w-2/3">
                    <label class="block text-sm font-medium text-gray-700">ISBN</label>
                    <input type="text" [(ngModel)]="newEntity.isbn"
                           class="w-full border border-gray-300 rounded-md p-2 mt-1">
                  </div>
                  <div class="w-1/3">
                    <label class="block text-sm font-medium text-gray-700">Publication Year</label>
                    <input type="number" [(ngModel)]="newEntity.publicationYear"
                           class="w-full border border-gray-300 rounded-md p-2 mt-1">
                  </div>
                </div>
              </div>
            </div>
      
            <!-- RIGHT: Bookshelf Grid -->
            <div *ngIf="selectedBookshelf" class="flex flex-col items-center md:w-[40%]">
              <h4 class="text-sm font-medium text-gray-700 mb-2 text-center">Click a slot on the bookshelf:</h4>
              <div class="grid gap-1 bg-gray-200 p-3 border border-green-600 rounded"
                   [style.gridTemplateColumns]="'repeat(' + selectedBookshelf.numberOfColumns + ', 40px)'"
                   [style.gridTemplateRows]="'repeat(' + selectedBookshelf.numberOfRows + ', 40px)'">
                <div *ngFor="let cell of bookshelfGrid; let i = index"
                     (click)="selectCell(i)"
                     [ngClass]="{
                       'bg-green-500 text-white': isSelectedCell(i),
                       'bg-white': !isSelectedCell(i)
                     }"
                     class="w-10 h-10 text-xs flex items-center justify-center border border-gray-300 cursor-pointer hover:bg-green-100">
                  {{ getCellPosition(i) }}
                </div>
              </div>
            </div>
      
          </div>
      
          <!-- Buttons -->
          <div class="mt-4 flex justify-end space-x-2">
            <button (click)="closeCreateModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
            <button (click)="saveEntity()" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
          </div>
        </div>
      </div>
      

    <!-- Edit Modal -->
<div *ngIf="isEditModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-200 bg-opacity-100">
    <div class="bg-white p-6 rounded-lg shadow-lg w-[90vw] max-w-5xl">
      <h3 class="text-lg font-semibold mb-4">Edit {{ getEntityName() }}</h3>
  
      <div class="flex flex-col md:flex-row gap-8">
        
        <!-- LEFT: form -->
        <div class="flex-1">
          <!-- pro domácnosti a místnosti -->
          <div *ngIf="editEntity && (currentView !== 'bookshelves' && currentView !== 'books')">
            <label class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" [(ngModel)]="editEntity.name"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
  
          <!-- bookshelves -->
          <div *ngIf="currentView === 'bookshelves' && editEntity">
            <label class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" [(ngModel)]="editEntity.name"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Description</label>
            <input type="text" [(ngModel)]="editEntity.description"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Columns</label>
            <input type="number" [(ngModel)]="editEntity.numberOfColumns"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Rows</label>
            <input type="number" [(ngModel)]="editEntity.numberOfRows"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
  
          <!-- books -->
          <div *ngIf="currentView === 'books' && editEntity">
            <label class="block text-sm font-medium text-gray-700 mt-3">Household</label>
            <select [(ngModel)]="editEntity.householdId"
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              <option *ngFor="let h of householdOptions" [value]="h.id">{{ h.name }}</option>
            </select>
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Room</label>
            <select [(ngModel)]="editEntity.roomId"
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              <option *ngFor="let r of roomOptions" [value]="r.id">{{ r.name }}</option>
            </select>
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Bookshelf</label>
            <select [(ngModel)]="editEntity.bookshelfId"
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              <option *ngFor="let b of bookshelfOptions" [value]="b.id">{{ b.name }}</option>
            </select>
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Title</label>
            <input type="text" [(ngModel)]="editEntity.title"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Author</label>
            <input type="text" [(ngModel)]="editEntity.author"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Genre</label>
            <input type="text" [(ngModel)]="editEntity.genre"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">ISBN</label>
            <input type="text" [(ngModel)]="editEntity.isbn"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
  
            <label class="block text-sm font-medium text-gray-700 mt-3">Publication Year</label>
            <input type="number" [(ngModel)]="editEntity.publicationYear"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
        </div>
  
        <!-- RIGHT: Bookshelf Grid -->
        <div *ngIf="currentView === 'books' && selectedBookshelf"
             class="flex flex-col items-center md:w-[40%]">
          <h4 class="text-sm font-medium text-gray-700 mb-2 text-center">Update Book's Placement on the Bookshelf:</h4>
          <div class="grid gap-1 bg-gray-200 p-3 border border-green-600 rounded"
               [style.gridTemplateColumns]="'repeat(' + selectedBookshelf.numberOfColumns + ', 40px)'"
               [style.gridTemplateRows]="'repeat(' + selectedBookshelf.numberOfRows + ', 40px)'">
            <div *ngFor="let cell of bookshelfGrid; let i = index" (click)="selectEditCell(i)"
                 [ngClass]="{
                   'bg-green-500 text-white': isEditSelectedCell(i),
                   'bg-white': !isEditSelectedCell(i)
                 }"
                 class="w-10 h-10 text-xs flex items-center justify-center border border-gray-300 cursor-pointer hover:bg-green-100">
              {{ getCellPosition(i) }}
            </div>
          </div>
        </div>
      </div>
  
      <!-- Buttons -->
      <div class="mt-4 flex justify-end space-x-2">
        <button (click)="closeEditModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
        <button (click)="saveEditEntity()" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
      </div>
    </div>
  </div>
  


    <div *ngIf="isDeleteModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50">
        <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
            <h3 class="text-lg font-semibold text-gray-800">Delete This {{ getEntityName() }}</h3>
            <p class="text-gray-600 mb-4">Everything part of this {{ getEntityName() }} will be deleted. Are you sure
                you
                want to do it?</p>

            <div class="flex justify-center space-x-4">
                <button (click)="isDeleteModalOpen = false"
                    class="py-2 px-4 border border-gray-300 rounded-md hover:bg-gray-100">
                    No, cancel
                </button>
                <button (click)="deleteEntity()" class="py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700">
                    Yes, delete
                </button>
            </div>
        </div>
    </div>
</div>